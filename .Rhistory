summarise(across(matches("entropy_tag_spend$|entropy_tag_spend_s$"), ~mean(.x))) %>%
ungroup() %>%
filter(between(ntile(x, 100), 5, 95)) %>%
pivot_longer(!x) %>%
ggplot(aes(x, value, colour=name)) +
geom_point(alpha = 0.5)
plots[[c]] <- g
}
plots[["txns_count_spend"]]
plots[["nunique_tag_spend"]]
plots[["std_tag_spend"]]
plots[["txns_count_spend"]]
d
d$resid
d$resid %>%
ggplot() +
geom_histogram()
plot(d$resid)
plot(d$std_tag_spend, d$resid)
library(cowplot)
library(dplyr)
library(ggplot2)
library(lubridate)
library(patchwork)
source('./src/config.R')
source('./src/helpers/helpers.R')
theme_set(theme_minimal())
df <- read_analysis_data("XX0_debug")
names(df)
df$ymn
df %>%
filter(between(ymn, 201901, 201912))%>%
ggplot() +
geom_density(aes(yr_income, color = source), alpha = 0.2) +
scale_x_continuous(labels = scales::comma) +
labs(x = 'Disposable income (£) in 2019', y = 'Density', color = "") +
theme(legend.position = c(0.9, 0.9))
df %>%
filter(between(ymn, 201901, 201912))%>%
ggplot() +
geom_density(aes(year_income, color = source), alpha = 0.2) +
scale_x_continuous(labels = scales::comma) +
labs(x = 'Disposable income (£) in 2019', y = 'Density', color = "") +
theme(legend.position = c(0.9, 0.9))
names(df)
df %>%
filter(between(ymn, 201901, 201912))%>%
ggplot() +
geom_density(aes(year_income, color = source), alpha = 0.2)
df %>%
filter(between(ymn, 201901, 201912))%>%
ggplot() +
geom_density(aes(year_income))
df %>%
filter(
between(ymn, 201901, 201912),
ntile(year_income, 100) <= 95) %>%
ggplot() +
geom_density(aes(year_income))
df %>%
filter(
between(ymn, 201901, 201912),
ntile(year_income, 100) <= 99) %>%
ggplot() +
geom_density(aes(year_income))
lcfs <- read_lcfs()
lcfs
df %>%
filter(ymn == 201904) %>%
transmute(
yr_income = year_income,
yr_spend = month_spend * 12,
source = 'MDB'
)
lcfs_data <- lcfs
df %>%
filter(ymn == 201904) %>%
transmute(
yr_income = year_income,
yr_spend = month_spend * 12,
source = 'MDB'
) %>%
bind_rows(lcfs_data)
df %>%
filter(ymn == 201904) %>%
transmute(
yr_income = year_income,
yr_spend = month_spend * 12,
source = 'MDB'
) %>%
bind_rows(lcfs_data) %>%
ggplot() +
geom_density(aes(yr_income, color = source), alpha = 0.2) +
scale_x_continuous(labels = scales::comma) +
labs(x = 'Disposable income (£) in 2019', y = 'Density', color = "") +
theme(legend.position = c(0.9, 0.9))
df %>%
filter(ymn == 201904) %>%
transmute(
yr_income = year_income,
yr_spend = month_spend * 12,
source = 'MDB'
) %>%
bind_rows(lcfs_data) %>%
ggplot() +
geom_density(aes(yr_income, color = source), alpha = 0.2)
lcfs_data <- read_lcfs()
lcfs_data
d <- df %>%
filter(ymn == 201904) %>%
transmute(
yr_income = year_income,
yr_spend = month_spend * 12,
source = 'MDB'
)
d
df %>%
filter(ymn == 201904) %>%
transmute(
yr_income = year_income,
yr_spend = month_spend * 12,
source = 'MDB'
) %>%
bind_rows(lcfs_data)
df %>%
filter(ymn == 201904) %>%
transmute(
yr_income = year_income,
yr_spend = month_spend * 12,
source = 'MDB'
) %>%
bind_rows(lcfs_data) %>%
ggplot() +
geom_density(aes(yr_income, color = source), alpha = 0.2)
df %>%
filter(ymn == 201904) %>%
transmute(
yr_income = year_income * 1000,
yr_spend = month_spend * 12 * 1000,
source = 'MDB'
) %>%
bind_rows(lcfs_data) %>%
ggplot() +
geom_density(aes(yr_income, color = source), alpha = 0.2)
df %>%
filter(ymn == 201904) %>%
transmute(
yr_income = year_income * 1000,
yr_spend = month_spend * 12 * 1000,
source = 'MDB'
) %>%
bind_rows(lcfs_data) %>%
ggplot() +
geom_density(aes(yr_income, color = source), alpha = 0.2) +
scale_x_continuous(labels = scales::comma) +
labs(x = 'Disposable income (£) in 2019', y = 'Density', color = "") +
theme(legend.position = c(0.9, 0.9))
df %>%
filter(ymn == 201904) %>%
transmute(
yr_income = year_income * 1000,
yr_spend = month_spend * 12 * 1000,
source = 'MDB'
) %>%
filter(ntile(year_income, 100) <= 99) %>%
bind_rows(lcfs_data) %>%
ggplot() +
geom_density(aes(yr_income, color = source), alpha = 0.2) +
scale_x_continuous(labels = scales::comma) +
labs(x = 'Disposable income (£) in 2019', y = 'Density', color = "") +
theme(legend.position = c(0.9, 0.9))
df %>%
filter(ymn == 201904) %>%
transmute(
yr_income = year_income * 1000,
yr_spend = month_spend * 12 * 1000,
source = 'MDB'
) %>%
filter(ntile(year_income, 100) <= 99) %>%
bind_rows(lcfs_data) %>%
ggplot() +
geom_density(aes(yr_income, color = source), alpha = 0.2) +
scale_x_continuous(labels = scales::comma) +
labs(x = 'Disposable income (£) in 2019', y = 'Density', color = "") +
theme(legend.position = c(0.9, 0.9))
df %>%
filter(ymn == 201904) %>%
transmute(
yr_income = year_income * 1000,
yr_spend = month_spend * 12 * 1000,
source = 'MDB'
) %>%
filter(ntile(yr_income, 100) <= 99) %>%
bind_rows(lcfs_data) %>%
ggplot() +
geom_density(aes(yr_income, color = source), alpha = 0.2) +
scale_x_continuous(labels = scales::comma) +
labs(x = 'Disposable income (£) in 2019', y = 'Density', color = "") +
theme(legend.position = c(0.9, 0.9))
fn <- "year_income.png"
ggsave(file.path(FIGDIR, fn), height = 2000, width = 3000, units = "px")
df %>%
filter(ymn == 201904) %>%
transmute(
yr_income = year_income * 1000,
yr_spend = month_spend * 12 * 1000,
source = 'MDB'
) %>%
filter(ntile(yr_income, 100) <= 99) %>%
bind_rows(lcfs_data) %>%
ggplot() +
geom_density(aes(yr_income, color = source), alpha = 0.2) +
scale_x_continuous(labels = scales::comma) +
labs(x = 'Disposable income (£) in 2019', y = 'Density', color = "") +
theme(
axis.title=element_text(size = 20),
axis.text = element_text(size = 20),
legend.position = c(0.9, 0.9)
)
ggsave(file.path(FIGDIR, fn), height = 2000, width = 3000, units = "px")
df %>%
filter(ymn == 201904) %>%
transmute(
yr_income = year_income * 1000,
yr_spend = month_spend * 12 * 1000,
source = 'MDB'
) %>%
filter(ntile(yr_income, 100) <= 99) %>%
bind_rows(lcfs_data) %>%
ggplot() +
geom_density(aes(yr_income, color = source), alpha = 0.2) +
scale_x_continuous(labels = scales::comma) +
labs(x = 'Disposable income (£) in 2019', y = 'Density', color = "") +
theme(
axis.title=element_text(size = 20),
axis.text = element_text(size = 20),
legend.text = element_text(size = 20),
legend.position = c(0.9, 0.9)
)
ggsave(file.path(FIGDIR, fn), height = 2000, width = 3000, units = "px")
theme_set(
theme_minimal(),
axis.title=element_text(size = 20),
axis.text = element_text(size = 20),
legend.text = element_text(size = 20),
)
theme_set(
theme_minimal(
axis.title=element_text(size = 20),
axis.text = element_text(size = 20),
legend.text = element_text(size = 20),
),
)
theme_set(
theme_minimal(
axis.title=element_text(size = 20),
axis.text = element_text(size = 20),
legend.text = element_text(size = 20)
)
)
theme_set(
theme_minimal(),
axis.title=element_text(size = 20),
axis.text = element_text(size = 20),
legend.text = element_text(size = 20)
)
theme_set(theme_minimal())
df %>%
filter(ymn == 201904) %>%
transmute(
yr_spend = month_spend * 12 * 1000,
source = 'MDB'
) %>%
filter(ntile(yr_income, 100) <= 99) %>%
bind_rows(lcfs_data) %>%
ggplot() +
geom_density(aes(yr_spend, color = source), alpha = 0.2) +
scale_x_continuous(labels = scales::comma) +
labs(x = 'Total spend (£) in 2019', y = 'Density', color = "") +
coord_cartesian(xlim = c(0, 125000)) +
theme(legend.position = c(0.9, 0.9))
df %>%
filter(ymn == 201904) %>%
transmute(
yr_spend = month_spend * 12 * 1000,
source = 'MDB'
) %>%
filter(ntile(yr_spend, 100) <= 99) %>%
bind_rows(lcfs_data) %>%
ggplot() +
geom_density(aes(yr_spend, color = source), alpha = 0.2) +
scale_x_continuous(labels = scales::comma) +
labs(x = 'Total spend (£) in 2019', y = 'Density', color = "") +
coord_cartesian(xlim = c(0, 125000)) +
theme(legend.position = c(0.9, 0.9))
fn <- "year_spend.png"
df %>%
filter(ymn == 201904) %>%
transmute(
yr_spend = month_spend * 12 * 1000,
source = 'MDB'
) %>%
filter(ntile(yr_spend, 100) <= 99) %>%
bind_rows(lcfs_data) %>%
ggplot() +
geom_density(aes(yr_spend, color = source), alpha = 0.2) +
scale_x_continuous(labels = scales::comma) +
labs(x = 'Total spend (£) in 2019', y = 'Density', color = "") +
coord_cartesian(xlim = c(0, 125000)) +
theme(
axis.title=element_text(size = 20),
axis.text = element_text(size = 20),
legend.text = element_text(size = 20),
legend.position = c(0.9, 0.9)
)
ggsave(file.path(FIGDIR, fn), height = 2000, width = 3000, units = "px")
df %>%
group_by(user_id) %>%
summarise(age = first(age)) %>%
count(age) %>%
ggplot() +
geom_point(aes(age, n / sum(n)), colour = palette[1]) +
scale_y_continuous(labels = scales::percent) +
labs(x = "Age", y = "Percent")
fn <- "age.png"
df %>%
group_by(user_id) %>%
summarise(age = first(age)) %>%
count(age) %>%
ggplot() +
geom_point(aes(age, n / sum(n)), colour = palette[1]) +
scale_y_continuous(labels = scales::percent) +
labs(x = "Age", y = "Percent")
df %>%
group_by(user_id) %>%
summarise(age = first(age)) %>%
count(age) %>%
ggplot() +
geom_point(aes(age, n / sum(n)), colour = palette[1]) +
scale_y_continuous(labels = scales::percent) +
labs(x = "Age", y = "Percent") +
theme(
axis.title=element_text(size = 20),
axis.text = element_text(size = 20),
legend.text = element_text(size = 20)
)
ggsave(file.path(FIGDIR, fn), height = 2000, width = 3000, units = "px")
fn <- "region.png"
df %>%
group_by(user_id) %>%
summarise(region = first(region)) %>%
count(region) %>%
mutate(region = tools::toTitleCase(region), prop = n / sum(n)) %>%
ggplot() +
geom_bar(aes(y = reorder(region, prop), x = prop),
stat = "identity",  fill =  palette[1]) +
scale_x_continuous(labels = scales::percent) +
theme(legend.position = "none") +
labs(x = 'Percent', y = 'Region')
df %>%
group_by(user_id) %>%
summarise(region = first(region)) %>%
count(region) %>%
mutate(region = tools::toTitleCase(region), prop = n / sum(n)) %>%
ggplot() +
geom_bar(aes(y = reorder(region, prop), x = prop),
stat = "identity",  fill =  palette[1]) +
scale_x_continuous(labels = scales::percent) +
theme(legend.position = "none") +
labs(x = 'Percent', y = 'Region') +
theme(
axis.title=element_text(size = 20),
axis.text = element_text(size = 20),
legend.text = element_text(size = 20)
)
ggsave(file.path(FIGDIR, fn), height = 2000, width = 3000, units = "px")
df <- read_analysis_data()
fn <- "year_income.png"
df %>%
filter(ymn == 201904) %>%
transmute(
yr_income = year_income * 1000,
source = 'MDB'
) %>%
filter(ntile(yr_income, 100) <= 99) %>%
bind_rows(lcfs_data) %>%
ggplot() +
geom_density(aes(yr_income, color = source), alpha = 0.2) +
scale_x_continuous(labels = scales::comma) +
labs(x = 'Disposable income (£) in 2019', y = 'Density', color = "") +
theme(
axis.title=element_text(size = 20),
axis.text = element_text(size = 20),
legend.text = element_text(size = 20),
legend.position = c(0.9, 0.9)
)
ggsave(file.path(FIGDIR, fn), height = 2000, width = 3000, units = "px")
fn <- "year_spend.png"
df %>%
filter(ymn == 201904) %>%
transmute(
yr_spend = month_spend * 12 * 1000,
source = 'MDB'
) %>%
filter(ntile(yr_spend, 100) <= 99) %>%
bind_rows(lcfs_data) %>%
ggplot() +
geom_density(aes(yr_spend, color = source), alpha = 0.2) +
scale_x_continuous(labels = scales::comma) +
labs(x = 'Total spend (£) in 2019', y = 'Density', color = "") +
coord_cartesian(xlim = c(0, 125000)) +
theme(
axis.title=element_text(size = 20),
axis.text = element_text(size = 20),
legend.text = element_text(size = 20),
legend.position = c(0.9, 0.9)
)
ggsave(file.path(FIGDIR, fn), height = 2000, width = 3000, units = "px")
fn <- "age.png"
df %>%
group_by(user_id) %>%
summarise(age = first(age)) %>%
count(age) %>%
ggplot() +
geom_point(aes(age, n / sum(n)), colour = palette[1]) +
scale_y_continuous(labels = scales::percent) +
labs(x = "Age", y = "Percent") +
theme(
axis.title=element_text(size = 20),
axis.text = element_text(size = 20),
legend.text = element_text(size = 20)
)
ggsave(file.path(FIGDIR, fn), height = 2000, width = 3000, units = "px")
fn <- "region.png"
df %>%
group_by(user_id) %>%
summarise(region = first(region)) %>%
count(region) %>%
mutate(region = tools::toTitleCase(region), prop = n / sum(n)) %>%
ggplot() +
geom_bar(aes(y = reorder(region, prop), x = prop),
stat = "identity",  fill =  palette[1]) +
scale_x_continuous(labels = scales::percent) +
theme(legend.position = "none") +
labs(x = 'Percent', y = 'Region') +
theme(
axis.title=element_text(size = 20),
axis.text = element_text(size = 20),
legend.text = element_text(size = 20)
)
ggsave(file.path(FIGDIR, fn), height = 2000, width = 3000, units = "px")
fn <- "year_spend.png"
df %>%
filter(ymn == 201904) %>%
transmute(
yr_spend = month_spend * 12 * 1000,
source = 'APP'
) %>%
filter(ntile(yr_spend, 100) <= 99) %>%
bind_rows(lcfs_data) %>%
ggplot() +
geom_density(aes(yr_spend, color = source), alpha = 0.2) +
scale_x_continuous(labels = scales::comma) +
labs(x = 'Total spend (£) in 2019', y = 'Density', color = "") +
coord_cartesian(xlim = c(0, 125000)) +
theme(
axis.title=element_text(size = 20),
axis.text = element_text(size = 20),
legend.text = element_text(size = 20),
legend.position = c(0.9, 0.9)
)
fn <- "year_income.png"
df %>%
filter(ymn == 201904) %>%
transmute(
yr_income = year_income * 1000,
source = 'APP'
) %>%
filter(ntile(yr_income, 100) <= 99) %>%
bind_rows(lcfs_data) %>%
ggplot() +
geom_density(aes(yr_income, color = source), alpha = 0.2) +
scale_x_continuous(labels = scales::comma) +
labs(x = 'Disposable income (£) in 2019', y = 'Density', color = "") +
theme(
axis.title=element_text(size = 20),
axis.text = element_text(size = 20),
legend.text = element_text(size = 20),
legend.position = c(0.9, 0.9)
)
ggsave(file.path(FIGDIR, fn), height = 2000, width = 3000, units = "px")
fn <- "year_spend.png"
df %>%
filter(ymn == 201904) %>%
transmute(
yr_spend = month_spend * 12 * 1000,
source = 'APP'
) %>%
filter(ntile(yr_spend, 100) <= 99) %>%
bind_rows(lcfs_data) %>%
ggplot() +
geom_density(aes(yr_spend, color = source), alpha = 0.2) +
scale_x_continuous(labels = scales::comma) +
labs(x = 'Total spend (£) in 2019', y = 'Density', color = "") +
coord_cartesian(xlim = c(0, 125000)) +
theme(
axis.title=element_text(size = 20),
axis.text = element_text(size = 20),
legend.text = element_text(size = 20),
legend.position = c(0.9, 0.9)
)
ggsave(file.path(FIGDIR, fn), height = 2000, width = 3000, units = "px")
