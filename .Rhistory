order = c('[Ee]ntropy', "Unique", "Category counts", "Number of"),
file=file.path(TABDIR, glue('reg_{y}_{lab}.tex')),
replace = T
)
)
}
lab <- "lag"
for (y in yvars) {
entropy <- lagged_entropy_vars(df)
print(
etable(
fixest::feols(.[y] ~ sw(.[,entropy]) + ..controls | ..fe, df),
order = c('[Ee]ntropy', '!Unique'),
file=file.path(TABDIR, glue('reg_{y}_{lab}.tex')),
replace = T
)
)
}
lab <- "main"
for (y in yvars) {
entropy <- entropy_vars(df)
print(
etable(
fixest::feols(.[y] ~ sw(.[,entropy]) + ..controls | ..fe, df),
order = c('[Ee]ntropy', '!(Intercept)'),
file=file.path(TABDIR, glue('reg_{y}_{lab}.tex')),
replace = T
)
)
}
source('src/config.R')
lab <- "main"
for (y in yvars) {
entropy <- entropy_vars(df)
print(
etable(
fixest::feols(.[y] ~ sw(.[,entropy]) + ..controls | ..fe, df),
order = c('[Ee]ntropy', '!(Intercept)'),
file=file.path(TABDIR, glue('reg_{y}_{lab}.tex')),
replace = T
)
)
}
lab <- "comp"
evars <- c("entropy_tag_z", "entropy_tag_sz", "entropy_tag_spend_z", "entropy_tag_spend_sz")
for (y in yvars) {
results <- list()
for (e in evars) {
results[[e]] <- feols(.[y] ~ .[e] + sw0(..comps) + ..controls | ..fe, df)
}
print(
etable(
results[[1]], results[[2]],
order = c('[Ee]ntropy', "Unique", "Category counts", "Number of"),
file=file.path(TABDIR, glue('reg_{y}_{lab}.tex')),
replace = T
)
)
}
results
for (y in yvars) {
results <- list()
for (e in evars) {
results[[e]] <- feols(.[y] ~ .[e] + sw0(..comps) + ..controls | ..fe, df)
}
print(
etable(
results,
order = c('[Ee]ntropy', "Unique", "Category counts", "Number of"),
file=file.path(TABDIR, glue('reg_{y}_{lab}.tex')),
replace = T
)
)
}
for (y in yvars) {
results <- vector()
for (e in evars) {
results[[e]] <- feols(.[y] ~ .[e] + sw0(..comps) + ..controls | ..fe, df)
}
print(
etable(
results,
order = c('[Ee]ntropy', "Unique", "Category counts", "Number of"),
file=file.path(TABDIR, glue('reg_{y}_{lab}.tex')),
replace = T
)
)
}
for (y in yvars) {
results <- list()
for (e in evars) {
results[[e]] <- feols(.[y] ~ .[e] + sw0(..comps) + ..controls | ..fe, df)
}
print(
etable(
results,
order = c('[Ee]ntropy', "Unique", "Category counts", "Number of"),
file=file.path(TABDIR, glue('reg_{y}_{lab}.tex')),
replace = T
)
)
}
for (y in yvars) {
results <- list()
for (e in evars) {
results[[e]] <- feols(.[y] ~ .[e] + sw0(..comps) + ..controls | ..fe, df)
}
print(
etable(
results[[1]], results[[2]], results[[3]], results[[4]],
order = c('[Ee]ntropy', "Unique", "Category counts", "Number of"),
file=file.path(TABDIR, glue('reg_{y}_{lab}.tex')),
replace = T
)
)
}
evars <- c("entropy_tag_z", "entropy_tag_sz", "entropy_tag_spend_z", "entropy_tag_spend_sz", "entropy_merchant_z", "entropy_merchant_sz")
for (y in yvars) {
results <- list()
for (e in evars) {
results[[e]] <- feols(.[y] ~ .[e] + sw0(..comps) + ..controls | ..fe, df)
}
print(
etable(
results[[1]], results[[2]], results[[3]], results[[4]], results[[5]], results[[6]],
order = c('[Ee]ntropy', "Unique", "Category counts", "Number of"),
file=file.path(TABDIR, glue('reg_{y}_{lab}.tex')),
replace = T
)
)
}
?etable
lab <- "comp"
evars <- c("entropy_tag_spend_z", "entropy_tag_spend_sz")
for (y in yvars) {
results <- list()
for (e in evars) {
results[[e]] <- feols(.[y] ~ .[e] + sw0(..comps) + ..controls | ..fe, df)
}
print(
etable(
results[[1]], results[[2]], results[[3]], results[[4]], results[[5]], results[[6]],
order = c('[Ee]ntropy', "Unique", "Category counts", "Number of"),
file=file.path(TABDIR, glue('reg_{y}_{lab}.tex')),
replace = T
)
)
}
for (y in yvars) {
results <- list()
for (e in evars) {
results[[e]] <- feols(.[y] ~ .[e] + sw0(..comps) + ..controls | ..fe, df)
}
print(
etable(
results[[1]], results[[2]],
order = c('[Ee]ntropy', "Unique", "Category counts", "Number of"),
file=file.path(TABDIR, glue('reg_{y}_{lab}.tex')),
replace = T
)
)
}
for (y in yvars) {
results <- list()
for (e in evars) {
results[[e]] <- feols(.[y] ~ .[e] + sw0(..comps) + ..controls | ..fe, df)
}
print(
etable(
results[[1]], results[[2]],
order = c('[Ee]ntropy', "Unique", "Category counts", "Number of"),
file=file.path(TABDIR, glue('reg_{y}_{lab}.tex')),
replace = T
)
)
}
lab <- "entropy_on_components"
evars <- c("entropy_tag_spend_z", "entropy_tag_spend_sz")
print(
etable(
feols(.[evars] ~ ..comps | sw0(..fe), df),
order = c('!(Intercept)', "Unique", "Category counts", "Number of"),
headers=list("Entropy (48 cats)"=2, "Entropy (48 cats, smooth)"=2),
file=file.path(TABDIR, glue('reg_{lab}.tex')),
replace = T
)
)
lab <- "entropy_on_components"
evars <- c("entropy_tag_z", "entropy_tag_sz", "entropy_tag_spend_z", "entropy_tag_spend_sz")
print(
etable(
feols(.[evars] ~ ..comps | ..fe, df),
order = c('!(Intercept)', "Unique", "Category counts", "Number of"),
headers=list("Entropy (9 cats)", "Entropy (9 cats, smooth)", "Entropy (48 cats)", "Entropy (48 cats, smooth)"),
file=file.path(TABDIR, glue('reg_{lab}.tex')),
replace = T
)
)
evars <- c("entropy_tag_z", "entropy_tag_sz", "entropy_tag_spend_z", "entropy_tag_spend_sz")
print(
etable(
feols(.[evars] ~ ..comps | ..fe, df),
order = c('!(Intercept)', "Unique", "Category counts", "Number of"),
headers=c("Entropy (9 cats)", "Entropy (9 cats, smooth)", "Entropy (48 cats)", "Entropy (48 cats, smooth)"),
file=file.path(TABDIR, glue('reg_{lab}.tex')),
replace = T
)
)
p <- "^ct_tag_spend"
p <- "^ct_tag_spend"
d <- df %>%
sample_frac(0.1) %>%
rowwise() %>%
mutate(
across(matches(p, perl = T), ~(.x + 1) / (txns_count_spend + 9), .names = "ps_{col}"),
across(matches(p, perl = T), ~.x / txns_count_spend, .names = "p_{col}"),
ps_std = sd(c_across(starts_with("ps_"))),
p_std = sd(c_across(starts_with("p_"))),
) %>%
ungroup() %>%
mutate(
p_std_q = ntile(p_std, 5),
ps_std_q = ntile(ps_std, 5),
std_tag_spend_q = ntile(std_tag_spend, 5),
txns_count_spend_q = ntile(txns_count_spend, 5),
entropy_tag_spend_pct = ntile(entropy_tag_spend, 100),
entropy_tag_spend_s_pct = ntile(entropy_tag_spend_s, 100),
nunique_tag_spend_lab = paste("Unique categories:", nunique_tag_spend)
)
facet_var <- c("std_tag_q")
facet_var <- c("std_tag_q")
for (v in facet_var) {
print(
d %>%
ggplot(aes(entropy_tag_spend_pct, entropy_tag_spend_s_pct, colour=factor(.data[[v]]))) +
geom_point() +
geom_smooth(method = "lm", se = FALSE, colour = "white", size=1) +
facet_wrap(~nunique_tag_spend_lab, nrow = 2) +
labs(
x = varlabs[["entropy_tag_pct"]],
y = varlabs[["entropy_tag_s_pct"]],
colour = unname(TeX(varlabs[[v]]))
) +
theme(
legend.position = "top"
)
# fn <- glue("scatter_facet_{v}.pdf")
# ggsave(file.path(FIGDIR, fn), height = 2000, width = 3000, units = "px")
)
}
facet_var <- c("std_tag_spend_q")
for (v in facet_var) {
print(
d %>%
ggplot(aes(entropy_tag_spend_pct, entropy_tag_spend_s_pct, colour=factor(.data[[v]]))) +
geom_point() +
geom_smooth(method = "lm", se = FALSE, colour = "white", size=1) +
facet_wrap(~nunique_tag_spend_lab, nrow = 2) +
labs(
x = varlabs[["entropy_tag_pct"]],
y = varlabs[["entropy_tag_s_pct"]],
colour = unname(TeX(varlabs[[v]]))
) +
theme(
legend.position = "top"
)
# fn <- glue("scatter_facet_{v}.pdf")
# ggsave(file.path(FIGDIR, fn), height = 2000, width = 3000, units = "px")
)
}
source('src/config.R')
source('src/helpers/helpers.R')
for (v in facet_var) {
print(
d %>%
ggplot(aes(entropy_tag_spend_pct, entropy_tag_spend_s_pct, colour=factor(.data[[v]]))) +
geom_point() +
geom_smooth(method = "lm", se = FALSE, colour = "white", size=1) +
facet_wrap(~nunique_tag_spend_lab, nrow = 2) +
labs(
x = varlabs[["entropy_tag_pct"]],
y = varlabs[["entropy_tag_s_pct"]],
colour = unname(TeX(varlabs[[v]]))
) +
theme(
legend.position = "top"
)
# fn <- glue("scatter_facet_{v}.pdf")
# ggsave(file.path(FIGDIR, fn), height = 2000, width = 3000, units = "px")
)
}
for (v in facet_var) {
print(
d %>%
ggplot(aes(entropy_tag_spend_pct, entropy_tag_spend_s_pct, colour=factor(.data[[v]]))) +
geom_point() +
geom_smooth(method = "lm", se = FALSE, colour = "white", size=1) +
facet_wrap(~nunique_tag_spend_lab) +
labs(
x = varlabs[["entropy_tag_pct"]],
y = varlabs[["entropy_tag_s_pct"]],
colour = unname(TeX(varlabs[[v]]))
) +
theme(
legend.position = "top"
)
# fn <- glue("scatter_facet_{v}.pdf")
# ggsave(file.path(FIGDIR, fn), height = 2000, width = 3000, units = "px")
)
}
d <- df %>%
sample_frac(0.1) %>%
rowwise() %>%
mutate(
across(matches(p, perl = T), ~(.x + 1) / (txns_count_spend + 9), .names = "ps_{col}"),
across(matches(p, perl = T), ~.x / txns_count_spend, .names = "p_{col}"),
ps_std = sd(c_across(starts_with("ps_"))),
p_std = sd(c_across(starts_with("p_"))),
) %>%
ungroup() %>%
mutate(
p_std_q = ntile(p_std, 5),
ps_std_q = ntile(ps_std, 5),
std_tag_spend_q = ntile(std_tag_spend, 5),
txns_count_spend_q = ntile(txns_count_spend, 5),
entropy_tag_spend_pct = ntile(entropy_tag_spend, 100),
entropy_tag_spend_s_pct = ntile(entropy_tag_spend_s, 100),
nunique_tag_spend_lab = paste("Unique categories:", nunique_tag_spend)
) %>%
arrange(nunique_tag_spend)
for (v in facet_var) {
print(
d %>%
ggplot(aes(entropy_tag_spend_pct, entropy_tag_spend_s_pct, colour=factor(.data[[v]]))) +
geom_point() +
geom_smooth(method = "lm", se = FALSE, colour = "white", size=1) +
facet_wrap(~nunique_tag_spend_lab) +
labs(
x = varlabs[["entropy_tag_pct"]],
y = varlabs[["entropy_tag_s_pct"]],
colour = unname(TeX(varlabs[[v]]))
) +
theme(
legend.position = "top"
)
# fn <- glue("scatter_facet_{v}.pdf")
# ggsave(file.path(FIGDIR, fn), height = 2000, width = 3000, units = "px")
)
}
d <- df %>%
sample_frac(0.1) %>%
rowwise() %>%
mutate(
across(matches(p, perl = T), ~(.x + 1) / (txns_count_spend + 9), .names = "ps_{col}"),
across(matches(p, perl = T), ~.x / txns_count_spend, .names = "p_{col}"),
ps_std = sd(c_across(starts_with("ps_"))),
p_std = sd(c_across(starts_with("p_"))),
) %>%
ungroup() %>%
mutate(
p_std_q = ntile(p_std, 5),
ps_std_q = ntile(ps_std, 5),
std_tag_spend_q = ntile(std_tag_spend, 5),
txns_count_spend_q = ntile(txns_count_spend, 5),
entropy_tag_spend_pct = ntile(entropy_tag_spend, 100),
entropy_tag_spend_s_pct = ntile(entropy_tag_spend_s, 100),
nunique_tag_spend_lab = paste("Unique categories:", nunique_tag_spend)
) %>%
arrange(nunique_tag_spend_lab)
for (v in facet_var) {
print(
d %>%
ggplot(aes(entropy_tag_spend_pct, entropy_tag_spend_s_pct, colour=factor(.data[[v]]))) +
geom_point() +
geom_smooth(method = "lm", se = FALSE, colour = "white", size=1) +
facet_wrap(~nunique_tag_spend_lab) +
labs(
x = varlabs[["entropy_tag_pct"]],
y = varlabs[["entropy_tag_s_pct"]],
colour = unname(TeX(varlabs[[v]]))
) +
theme(
legend.position = "top"
)
# fn <- glue("scatter_facet_{v}.pdf")
# ggsave(file.path(FIGDIR, fn), height = 2000, width = 3000, units = "px")
)
}
d <- df %>%
sample_frac(0.1) %>%
rowwise() %>%
mutate(
across(matches(p, perl = T), ~(.x + 1) / (txns_count_spend + 9), .names = "ps_{col}"),
across(matches(p, perl = T), ~.x / txns_count_spend, .names = "p_{col}"),
ps_std = sd(c_across(starts_with("ps_"))),
p_std = sd(c_across(starts_with("p_"))),
) %>%
ungroup() %>%
mutate(
p_std_q = ntile(p_std, 5),
ps_std_q = ntile(ps_std, 5),
std_tag_spend_q = ntile(std_tag_spend, 5),
txns_count_spend_q = ntile(txns_count_spend, 5),
entropy_tag_spend_pct = ntile(entropy_tag_spend, 100),
entropy_tag_spend_s_pct = ntile(entropy_tag_spend_s, 100),
nunique_tag_spend_lab = paste("Unique categories:", nunique_tag_spend)
) %>%
arrange(nunique_tag_spend)
for (v in facet_var) {
print(
d %>%
ggplot(aes(entropy_tag_spend_pct, entropy_tag_spend_s_pct, colour=factor(.data[[v]]))) +
geom_point() +
geom_smooth(method = "lm", se = FALSE, colour = "white", size=1) +
facet_wrap(~nunique_tag_spend_lab) +
labs(
x = varlabs[["entropy_tag_pct"]],
y = varlabs[["entropy_tag_s_pct"]],
colour = unname(TeX(varlabs[[v]]))
) +
theme(
legend.position = "top"
)
# fn <- glue("scatter_facet_{v}.pdf")
# ggsave(file.path(FIGDIR, fn), height = 2000, width = 3000, units = "px")
)
}
df$nunique_tag_spend
int(df$nunique_tag_spend)
integer(df$nunique_tag_spend)
as.integer(df$nunique_tag_spend)
d <- df %>%
sample_frac(0.1) %>%
rowwise() %>%
mutate(
across(matches(p, perl = T), ~(.x + 1) / (txns_count_spend + 9), .names = "ps_{col}"),
across(matches(p, perl = T), ~.x / txns_count_spend, .names = "p_{col}"),
ps_std = sd(c_across(starts_with("ps_"))),
p_std = sd(c_across(starts_with("p_"))),
) %>%
ungroup() %>%
mutate(
p_std_q = ntile(p_std, 5),
ps_std_q = ntile(ps_std, 5),
std_tag_spend_q = ntile(std_tag_spend, 5),
txns_count_spend_q = ntile(txns_count_spend, 5),
entropy_tag_spend_pct = ntile(entropy_tag_spend, 100),
entropy_tag_spend_s_pct = ntile(entropy_tag_spend_s, 100),
nunique_tag_spend_lab = paste("Unique categories:", nunique_tag_spend)
) %>%
arrange(as.integer(nunique_tag_spend))
for (v in facet_var) {
print(
d %>%
ggplot(aes(entropy_tag_spend_pct, entropy_tag_spend_s_pct, colour=factor(.data[[v]]))) +
geom_point() +
geom_smooth(method = "lm", se = FALSE, colour = "white", size=1) +
facet_wrap(~nunique_tag_spend_lab) +
labs(
x = varlabs[["entropy_tag_pct"]],
y = varlabs[["entropy_tag_s_pct"]],
colour = unname(TeX(varlabs[[v]]))
) +
theme(
legend.position = "top"
)
# fn <- glue("scatter_facet_{v}.pdf")
# ggsave(file.path(FIGDIR, fn), height = 2000, width = 3000, units = "px")
)
}
lab <- "comp"
evars <- c("entropy_tag_z", "entropy_tag_sz", "entropy_tag_spend_z", "entropy_tag_spend_sz")
for (y in yvars) {
results <- list()
for (e in evars) {
results[[e]] <- feols(.[y] ~ .[e] + sw0(..comps) + ..controls | ..fe, df)
}
print(
etable(
results[[1]], results[[2]], results[[3]], results[[4]],
order = c('[Ee]ntropy', "Unique", "Category counts", "Number of"),
file=file.path(TABDIR, glue('reg_{y}_{lab}.tex')),
replace = T
)
)
}
lab <- "entropy_on_components"
?etable
source('./src/config.R')
source('./src/helpers/helpers.R')
# Set complete scheme as baseline
theme_set(theme_minimal())
# Customise elements
theme_update(
axis.title=element_text(size = 14),
axis.text = element_text(size = 14),
legend.text = element_text(size = 14),
legend.title = element_text(size = 14),
)
dfa <- read_analysis_data()
library(dplyr)
library(ggdist)
library(ggplot2)
library(ggthemr)
library(lubridate)
library(patchwork)
library(plyr)
library(stringr)
library(data.table)
dfu <- read_final_users_data(dfa)
source('./src/helpers/helpers.R')
dfu <- read_final_users_data(dfa)
