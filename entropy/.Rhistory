# replace = T
))
}
xpd(has_sa_inflows ~ is_female)
endogs = c('sa_inflows', 'sa_netflows', 'sa_outflows')
for (endog in endogs) {
n <- grep(glue('entropy_.*_z'), names(dt), value = T, perl = T)
sn <- grep(glue('entropy_.*_sz'), names(dt), value = T, perl = T)
exog <- c(n, sn)
print(etable(
fixest::feols(
xpd(log1p(.[endog]) ~ sw(.[,exog]) + ..controls | user_id + ym + region_name,
..controls = controls),
data=dt
),
title = glue('{endog} results'),
order = '[Ee]ntropy',
notes = c(note)
# tex = T,
# fontsize = 'footnotesize',
# file=file.path(TABDIR, glue('reg_{endog}_full.tex')),
# label = glue('tab:reg_{endog}_full.tex'),
# replace = T
))
}
endogs = c('sa_inflows')
for (endog in endogs) {
n <- grep(glue('entropy_.*_z'), names(dt), value = T, perl = T)
sn <- grep(glue('entropy_.*_sz'), names(dt), value = T, perl = T)
exog <- c(n, sn)
print(etable(
fixest::feols(
xpd(log1p(.[endog]) ~ sw(.[,exog]) + ..controls | user_id + ym + region_name,
..controls = controls),
data=dt
),
title = glue('{endog} results'),
order = '[Ee]ntropy',
notes = c(note)
# tex = T,
# fontsize = 'footnotesize',
# file=file.path(TABDIR, glue('reg_{endog}_full.tex')),
# label = glue('tab:reg_{endog}_full.tex'),
# replace = T
))
}
print(etable(
fixest::feols(
xpd(log1p(.[endog]) ~ sw(.[,exog]) + ..controls | user_id + ym + region_name),
data=dt
),
title = glue('{endog} results'),
order = '[Ee]ntropy',
notes = c(note)
# tex = T,
# fontsize = 'footnotesize',
# file=file.path(TABDIR, glue('reg_{endog}_full.tex')),
# label = glue('tab:reg_{endog}_full.tex'),
# replace = T
))
for (endog in endogs) {
n <- grep(glue('entropy_.*_z'), names(dt), value = T, perl = T)
sn <- grep(glue('entropy_.*_sz'), names(dt), value = T, perl = T)
exog <- c(n, sn)
fml <- xpd(log1p(.[endog]) ~ sw(.[,exog]) + ..controls | user_id + ym + region_name)
print(etable(
fixest::feols(fml,
data=dt
),
title = glue('{endog} results'),
order = '[Ee]ntropy',
notes = c(note)
# tex = T,
# fontsize = 'footnotesize',
# file=file.path(TABDIR, glue('reg_{endog}_full.tex')),
# label = glue('tab:reg_{endog}_full.tex'),
# replace = T
))
}
for (endog in endogs) {
n <- grep(glue('entropy_.*_z'), names(dt), value = T, perl = T)
sn <- grep(glue('entropy_.*_sz'), names(dt), value = T, perl = T)
exog <- c(n, sn)
# take logs of flow outcomes
if (startsWith(endog, 'has')) {
fml <- xpd(.[endog] ~ sw(.[,exog]) + ..controls | user_id + ym + region_name)
} else {
fml <- xpd(log1p(.[endog]) ~ sw(.[,exog]) + ..controls | user_id + ym + region_name)
}
print(etable(
fixest::feols(fml, data=dt),
title = glue('{endog} results'),
order = '[Ee]ntropy',
notes = c(note)
# tex = T,
# fontsize = 'footnotesize',
# file=file.path(TABDIR, glue('reg_{endog}_full.tex')),
# label = glue('tab:reg_{endog}_full.tex'),
# replace = T
))
}
endogs = c('has_sa_inflows', 'sa_inflows', 'sa_netflows', 'sa_outflows')
for (endog in endogs) {
n <- grep(glue('entropy_.*_z'), names(dt), value = T, perl = T)
sn <- grep(glue('entropy_.*_sz'), names(dt), value = T, perl = T)
exog <- c(n, sn)
# take logs of flow outcomes
if (startsWith(endog, 'has')) {
fml <- xpd(.[endog] ~ sw(.[,exog]) + ..controls | user_id + ym + region_name)
} else {
fml <- xpd(log1p(.[endog]) ~ sw(.[,exog]) + ..controls | user_id + ym + region_name)
}
print(etable(
fixest::feols(fml, data=dt),
title = glue('{endog} results'),
order = '[Ee]ntropy',
notes = c(note)
# tex = T,
# fontsize = 'footnotesize',
# file=file.path(TABDIR, glue('reg_{endog}_full.tex')),
# label = glue('tab:reg_{endog}_full.tex'),
# replace = T
))
}
dt = read_analysis_data('XX7new')
cats = c('tag', 'tag_auto', 'merchant', 'groc')
setFixest_fml(
..controls = ~ prop_credit + log1p(spend_communication) + log1p(spend_finance) + log1p(spend_hobbies) + log1p(spend_household) + log1p(spend_motor) + log1p(spend_retail) + log1p(spend_services) + log1p(spend_travel) + log1p(spend_other_spend) + is_urban + log1p(year_income) + has_regular_income + has_loan_repmt + has_benefits
)
note <- "Notes: Spend and income variables are in \\pounds'000."
endogs = c('has_sa_inflows', 'sa_inflows', 'sa_netflows', 'sa_outflows')
for (endog in endogs) {
n <- grep(glue('entropy_.*_z'), names(dt), value = T, perl = T)
sn <- grep(glue('entropy_.*_sz'), names(dt), value = T, perl = T)
exog <- c(n, sn)
# take logs of flow outcomes
if (startsWith(endog, 'has')) {
fml <- xpd(.[endog] ~ sw(.[,exog]) + ..controls | user_id + ym + region_name)
} else {
fml <- xpd(log1p(.[endog]) ~ sw(.[,exog]) + ..controls | user_id + ym + region_name)
}
print(etable(
fixest::feols(fml, data=dt),
title = glue('{endog} results'),
order = '[Ee]ntropy',
notes = c(note)
# tex = T,
# fontsize = 'footnotesize',
# file=file.path(TABDIR, glue('reg_{endog}_full.tex')),
# label = glue('tab:reg_{endog}_full.tex'),
# replace = T
))
}
for (endog in endogs) {
n <- grep(glue('entropy_.*_z'), names(dt), value = T, perl = T)
sn <- grep(glue('entropy_.*_sz'), names(dt), value = T, perl = T)
exog <- c(n, sn)
# take logs of flow outcomes
if (startsWith(endog, 'has')) {
fml <- xpd(.[endog] ~ sw(.[,exog]) + ..controls | user_id + ym + region_name)
} else {
fml <- xpd(log1p(.[endog]) ~ sw(.[,exog]) + ..controls | user_id + ym + region_name)
}
print(etable(
fixest::feols(fml, data=dt),
title = glue('{endog} results'),
order = '[Ee]ntropy',
notes = c(note)
# tex = T,
# fontsize = 'footnotesize',
# file=file.path(TABDIR, glue('reg_{endog}_full.tex')),
# label = glue('tab:reg_{endog}_full.tex'),
# replace = T
))
}
dt <- read_analysis_data()
dt <- read_analysis_data('XX7new')
grep('^sa_.*flows$', names(dt), value = T)
ggplot(dt) +
geom_density(sa_inflows)
ggplot(dt) +
geom_density(sa_inflows)
names(dt)
ggplot(dt) +
geom_density(aes(sa_inflows))
for (endog in endogs) {
n <- grep(glue('entropy_.*_z'), names(dt), value = T, perl = T)
sn <- grep(glue('entropy_.*_sz'), names(dt), value = T, perl = T)
exog <- c(n, sn)
# take logs of flow outcomes
if (startsWith(endog, 'has')) {
fml <- xpd(.[endog] ~ sw(.[,exog]) + ..controls | user_id + ym + region_name)
} else {
fml <- xpd(log1p(.[endog]) ~ sw(.[,exog]) + ..controls | user_id + ym + region_name)
}
print(etable(
fixest::feols(fml, data=dt),
title = glue('{endog} results'),
order = '[Ee]ntropy',
notes = c(note)
# tex = T,
# fontsize = 'footnotesize',
# file=file.path(TABDIR, glue('reg_{endog}_full.tex')),
# label = glue('tab:reg_{endog}_full.tex'),
# replace = T
))
}
endogs = c('has_sa_inflows')
for (endog in endogs) {
n <- grep(glue('entropy_.*_z'), names(dt), value = T, perl = T)
sn <- grep(glue('entropy_.*_sz'), names(dt), value = T, perl = T)
exog <- c(n, sn)
# take logs of flow outcomes
if (startsWith(endog, 'has')) {
fml <- xpd(.[endog] ~ sw(.[,exog]) + ..controls | user_id + ym + region_name)
} else {
fml <- xpd(log1p(.[endog]) ~ sw(.[,exog]) + ..controls | user_id + ym + region_name)
}
print(etable(
fixest::feols(fml, data=dt),
title = glue('{endog} results'),
order = '[Ee]ntropy',
notes = c(note)
# tex = T,
# fontsize = 'footnotesize',
# file=file.path(TABDIR, glue('reg_{endog}_full.tex')),
# label = glue('tab:reg_{endog}_full.tex'),
# replace = T
))
}
cat_spends <- grep('spend_(?!month)', names(dt), value = T, perl = T)
controls = c(
# fin behaviour
'prop_credit',
# 'month_spend',
cat_spends,
# 'txn_count_ca',
# 'txn_count_sa',
# 'nunique_tag',
# planning - tbd
# hh / ind chars
# 'is_urban',
# 'month_income',
'year_income',
'has_regular_income',
'has_loan_repmt',
'has_benefits'
)
controls = c(
# fin behaviour
'prop_credit',
# 'month_spend',
cat_spends,
# 'txn_count_ca',
# 'txn_count_sa',
# 'nunique_tag',
# planning - tbd
# hh / ind chars
'is_urban',
# 'month_income',
'year_income',
'has_regular_income',
'has_loan_repmt',
'has_benefits'
)
controls = c(
# fin behaviour
'prop_credit',
# 'month_spend',
cat_spends,
# 'txn_count_ca',
# 'txn_count_sa',
# 'nunique_tag',
# planning - tbd
# hh / ind chars
'is_urban',
# 'month_income',
'year_income',
'has_regular_income',
'has_loan_repmt',
'has_benefits'
)
cat_spends <- grep('spend_(?!month)', names(dt), value = T, perl = T)
controls = c(
# fin behaviour
'prop_credit',
# 'month_spend',
cat_spends,
# 'txn_count_ca',
# 'txn_count_sa',
# 'nunique_tag',
# planning - tbd
# hh / ind chars
'is_urban',
# 'month_income',
'year_income',
'has_regular_income',
'has_loan_repmt',
'has_benefits'
)
setFixest_fml(
..controls = ~ prop_credit + log1p(spend_communication) + log1p(spend_finance) + log1p(spend_hobbies) + log1p(spend_household) + log1p(spend_motor) + log1p(spend_retail) + log1p(spend_services) + log1p(spend_travel) + log1p(spend_other_spend) + is_urban + log1p(year_income) + has_regular_income + has_loan_repmt + has_benefits
)
note <- "Notes: Spend and income variables are in \\pounds'000."
endogs = c('has_sa_inflows', 'sa_inflows', 'sa_netflows', 'sa_outflows')
endogs = c('has_sa_inflows')
for (endog in endogs) {
n <- grep(glue('entropy_.*_z'), names(dt), value = T, perl = T)
sn <- grep(glue('entropy_.*_sz'), names(dt), value = T, perl = T)
exog <- c(n, sn)
# take logs of flow outcomes
if (startsWith(endog, 'has')) {
fml <- xpd(.[endog] ~ sw(.[,exog]) + ..controls | user_id + ym + region_name)
fml <- xpd(.[endog] ~ sw(.[,exog]) + ..controls | user_id + ym + region_name, ..controls = controls)
} else {
fml <- xpd(log1p(.[endog]) ~ sw(.[,exog]) + ..controls | user_id + ym + region_name)
}
print(etable(
fixest::feols(fml, data=dt),
title = glue('{endog} results'),
order = '[Ee]ntropy',
notes = c(note)
# tex = T,
# fontsize = 'footnotesize',
# file=file.path(TABDIR, glue('reg_{endog}_full.tex')),
# label = glue('tab:reg_{endog}_full.tex'),
# replace = T
))
}
grep('^sa_.*flows$', names(dt), value = T)
flows <- dt[, grep('^sa_.*flows$', names(dt), value = T)]
flows
dt[, grep('^sa_.*flows$', names(dt), value = T)]
dt <- read_analysis_data('XX7new')
dt[, grep('^sa_.*flows$', names(dt), value = T)]
dt
dt[, .(grep('^sa_.*flows$', names(dt), value = T))]
dt[grep('^sa_.*flows$', names(dt), value = T)]
flows <- grep('^sa_.*flows$', names(dt), value = T)
df[, ..flows]
dt[, ..flows]
flows <- grep('^sa_.*flows$', names(dt), value = T)
dtf <- melt(dt[, ..flows], measure.vars = flows)
dtf
flows <- grep('^sa_.*flows$', names(dt), value = T)
dtf <- melt(dt[, ..flows], measure.vars = flows)
p <- ggplot(dtf) +
geom_density(aes(value))
p + facet_wrap(~variable, ncols = 3, scales = 'free')
# Entropy distributions ------------------------------------------------------------
dt <- read_analysis_data()
p + facet_wrap(~variable, ncols = 3, scales = 'free')
p + facet_wrap(~variable, ncol = 3, scales = 'free')
p <- ggplot(dtf) +
geom_density(aes(value)) +
facet_wrap(~variable, ncol = 3, scales = 'free')
p
p <- ggplot(dtf) +
geom_density(aes(value)) +
xlim(0, quantile(value, .95))
p <- ggplot(dtf) +
geom_density(aes(value)) +
xlim(0, quantile(~value, .95))
p <- ggplot(dtf) +
geom_density(aes(value)) +
xlim(0, quantile(~ value, .95))
p <- ggplot(dtf) +
geom_density(aes(value)) +
xlim(0, quantile(.value, .95))
p <- ggplot(dtf) +
geom_density(aes(value)) +
xlim(0, quantile(value, .95)) +
facet_wrap(~variable, ncol = 3, scales = 'free')
p <- ggplot(dtf) +
geom_density(aes(value)) +
xlim(0, quantile(~value, .95)) +
facet_wrap(~variable, ncol = 3, scales = 'free')
p <- ggplot(dtf) +
geom_density(aes(value)) +
facet_wrap(~variable, ncol = 3, scales = 'free')
# saving accounts flows
vars <- grep('^sa_.*flows$', names(dt), value = T)
data <- melt(dt[, ..vars], measure.vars = vars)
p <- ggplot(data) +
geom_density(aes(value)) +
facet_wrap(~variable, ncol = 3, scales = 'free')
# spends
vars <- grep('^spend_', names(dt), value = T)
data <- melt(dt[, ..vars], measure.vars = vars)
p <- ggplot(data) +
geom_density(aes(value)) +
facet_wrap(~variable, ncol = 3, scales = 'free')
p
dt <- read_analysis_data('XX7new')
dt
names(dt)
# spends
vars <- grep('^spend_', names(dt), value = T)
data <- melt(dt[, ..vars], measure.vars = vars)
ggplot(data) +
geom_density(aes(value)) +
facet_wrap(~variable, ncol = 3, scales = 'free')
# saving accounts flows
vars <- grep('^sa_.*flows$', names(dt), value = T)
data <- melt(dt[, ..vars], measure.vars = vars)
ggplot(data) +
geom_density(aes(value)) +
facet_wrap(~variable, ncol = 3, scales = 'free')
# tag spends
vars <- grep('^spend_', names(dt), value = T)
data <- melt(dt[, ..vars], measure.vars = vars)
ggplot(data) +
geom_density(aes(value)) +
facet_wrap(~variable, ncol = 3, scales = 'free')
# tag spends
vars <- grep('spend', names(dt), value = T)
data <- melt(dt[, ..vars], measure.vars = vars)
ggplot(data) +
geom_density(aes(value)) +
facet_wrap(~variable, ncol = 3, scales = 'free')
# entropy
vars <- grep('entropy', names(dt), value = T)
data <- melt(dt[, ..vars], measure.vars = vars)
ggplot(data) +
geom_density(aes(value)) +
facet_wrap(~variable, ncol = 3, scales = 'free')
facet_kdes('txn_count')
facet_kdes <- function(regex) {
vars <- grep(regex, names(dt), value = T)
data <- melt(dt[, ..vars], measure.vars = vars)
ggplot(data) +
geom_density(aes(value)) +
facet_wrap(~variable, ncol = 3, scales = 'free')
}
facet_kdes('txn_count')
# saving accounts flows
facet_kdes('^sa_.*flows$')
# entropy
facet_kdes('entropy')
# tag spends
facet_kdes('spend')
# txn counts
facet_kdes('txn_count')
# tag spends
facet_kdes('income')
theme_set(theme_minimal())
# txn counts
facet_kdes('txn_count')
# txn counts
facet_kdes('txn_count')
# saving accounts flows
facet_kdes('^sa_.*flows$')
# tag spends
facet_kdes('spend')
dt <- read_analysis_data('XX7')
facet_kdes <- function(regex) {
vars <- grep(regex, names(dt), value = T)
data <- melt(dt[, ..vars], measure.vars = vars)
ggplot(data) +
geom_density(aes(value)) +
facet_wrap(~variable, ncol = 3, scales = 'free')
}
# txn counts
facet_kdes('txn_count')
# saving accounts flows
facet_kdes('^sa_.*flows$')
# tag spends
facet_kdes('spend')
# income vars
facet_kdes('income')
dto = read_analysis_data('XX7old')
dto = read_analysis_data('XX7old')
dt = read_analysis_data()
names(dt)
# New ------------------------------------------------------------------------------
endogs = c('has_sa_inflows', 'sa_inflows', 'sa_netflows', 'sa_outflows')
cats = c('tag', 'tag_auto', 'merchant', 'groc')
cat_spends <- grep('spend_(?!month)', names(dt), value = T, perl = T)
controls = c(
# fin behaviour
'prop_credit',
# 'month_spend',
cat_spends,
# 'txn_count_ca',
# 'txn_count_sa',
# 'nunique_tag',
# planning - tbd
# hh / ind chars
'is_urban',
# 'month_income',
'year_income',
'has_regular_income',
'has_loan_repmt',
'has_benefits'
)
endogs = c('has_sa_inflows', 'sa_inflows', 'sa_netflows', 'sa_outflows')
for (endog in endogs) {
n <- grep(glue('entropy_.*_z'), names(dt), value = T, perl = T)
sn <- grep(glue('entropy_.*_sz'), names(dt), value = T, perl = T)
exog <- c(n, sn)
print(etable(
fixest::feols(xpd(.[endog] ~ sw(.[,exog]) + ..controls | user_id + ym + region_name, ..controls = controls), data=dt),
title = glue('{endog} results'),
order = '[Ee]ntropy',
notes = c(note)
# tex = T,
# fontsize = 'footnotesize',
# file=file.path(TABDIR, glue('reg_{endog}_full.tex')),
# label = glue('tab:reg_{endog}_full.tex'),
# replace = T
))
}
